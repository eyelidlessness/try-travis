machine:
    timezone:
        America/Los_Angeles

machine:
    python:
        version: 2.7.3
    services:
        - docker

dependencies:
    pre:
        - pip install awscli
    override:
        - docker info

test:
    override:
        - mkdir -p $CIRCLE_TEST_REPORTS/rspec
        - lein spec -f junit > $CIRCLE_TEST_REPORTS/rspec/junit.xml

deployment:
    elasticbeanstalk:
        branch:
            - develop
            - master
        commands:
            - lein run -m clojure.main scripts/build_static.clj
            - docker build -t eyelidlessness/try-circle:$CIRCLE_SHA1 .
            - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
            - ./elasticbeanstalk.sh $CIRCLE_SHA1
